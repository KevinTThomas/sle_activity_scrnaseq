Preprocessing 03: Quality control
================
Kevin Thomas
20 January, 2022

-   [Quality control of cells for initial
    analysis](#quality-control-of-cells-for-initial-analysis)

## Quality control of cells for initial analysis

``` r
pre_qc <- readRDS(file = here("demo_data", "pre_qc.RDS"))
gem_classification <- readRDS(file = here("demo_data", "gem_classification.RDS"))
```

``` r
# First, separate clear mouse and human cells
human <- subset(
  x = pre_qc,
  cells = gem_classification[which(gem_classification$call == str_remove_all(primary_species_prefix, "_")), ] |>
    mutate(cell_name = paste0(run, "_", cells)) |>
    pull(cell_name)
) |>
  PurgeXenoGenes(
    primary_species_prefix = str_replace_all(primary_species_prefix, "_", "-"),
    secondary_species_prefix = str_replace_all(secondary_species_prefix, "_", "-")
  )
```

    ## Warning: Adding a command log without an assay associated with it

``` r
mouse <- subset(
  x = pre_qc,
  cells = gem_classification[which(gem_classification$call == str_remove_all(secondary_species_prefix, "_")), ] |>
    mutate(cell_name = paste0(run, "_", cells)) |>
    pull(cell_name)
) |>
  PurgeXenoGenes(
    primary_species_prefix = str_replace_all(secondary_species_prefix, "_", "-"),
    secondary_species_prefix = str_replace_all(primary_species_prefix, "_", "-")
  )
```

    ## Warning: Adding a command log without an assay associated with it

``` r
# Filter on singlets only
human_singlets <- if ("HTO" %in% Seurat::Assays(human)) {
  subset(x = human, `final.HTO.ID` %nin% c("Negative", "Doublet"))
} else {
  pre_qc[, colnames(pre_qc) %in% gem_classification[gem_classification$call == str_remove(primary_species_prefix, "_"), ]$sample_barcode] |>
    PurgeXenoGenes(
      primary_species_prefix = str_replace_all(primary_species_prefix, "_", "-"),
      secondary_species_prefix = str_replace_all(secondary_species_prefix, "_", "-")
    )
}
# Free memory
rm(pre_qc, human, mouse)
gc()
```

    ##            used  (Mb) gc trigger  (Mb)  max used   (Mb)
    ## Ncells  3421947 182.8    5498588 293.7   5498588  293.7
    ## Vcells 25467186 194.3  111312187 849.3 139138962 1061.6

``` r
# Perform QC by setting global cutoffs
qc_object <- PercentageFeatureSet(
  object = human_singlets,
  pattern = "^MT-",
  col.name = "percent_mt"
) %>%
  PercentageFeatureSet(
    pattern = "^HB[ABDEGMQZ].?$",
    col.name = "percent_hemo"
  ) %>%
  subset(
    features = c(
      paste0("rna_", names(which(rowSums(.[["RNA"]]@counts >= 1) >= 3))),
      paste0("cite_", rownames(.[["CITE"]])),
      paste0("hto_", rownames(.[["HTO"]]))
    )
  ) %>%
  # Remove the low feature, high mito, and high hemo count cells
  subset(
    `nFeature_RNA` >= 40 &
      `percent_mt` <= 25 &
      `percent_hemo` <= 1.5
  ) |>
  # Score Ig gene differences
  ScoreIgDiffs(
    assay = "RNA",
    ig.hc = IG_genes[1:10],
    ig.lc = IG_genes[11:18],
    conserve.memory = TRUE
  )
```

    ## Normalizing data...

    ## Calculating cell attributes from input UMI matrix: log_umi

    ## Variance stabilizing transformation of count matrix of size 17584 by 13231

    ## Model formula is y ~ log_umi

    ## Get Negative Binomial regression parameters per gene

    ## Using 2000 genes, 5000 cells

    ##   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |   0%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==========================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |  25%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |  50%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                          |  75%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================| 100%

    ## Found 112 outliers - those will be ignored in fitting/regularization step

    ## Skip calculation of full residual matrix

    ## Will not return corrected UMI because residual type is not set to 'pearson'

    ## Calculating gene attributes

    ## Wall clock passed: Time difference of 22.31031 secs

    ## Setting min_variance to:  -Inf

    ## Calculating variance for residuals of type pearson for 17584 genes

    ##   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |   0%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |   1%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |   3%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |====================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |   4%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=====================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |   6%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |======================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |   7%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=======================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |   9%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=========================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |  10%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==========================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |  12%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===========================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |  13%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |============================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |  14%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==============================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |  16%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===============================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |  17%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |  19%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |  20%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |  22%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |====================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |  23%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=====================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |  25%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |======================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |  26%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |========================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |  28%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=========================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |  29%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==========================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |  30%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===========================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |  32%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=============================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |  33%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==============================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |  35%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===============================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |  36%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |  38%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |  39%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |  41%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |  42%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |  43%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |  45%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |  46%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |  48%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |  49%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |  51%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |  52%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |  54%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |  55%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |  57%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |  58%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |  59%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |  61%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                |  62%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                               |  64%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                              |  65%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                             |  67%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                           |  68%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                          |  70%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                         |  71%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                        |  72%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                      |  74%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                     |  75%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                    |  77%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                   |  78%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                 |  80%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                |  81%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                               |  83%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                              |  84%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                            |  86%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                           |  87%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                          |  88%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                         |  90%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                       |  91%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                      |  93%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                     |  94%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                    |  96%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                  |  97%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                 |  99%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================| 100%

    ## Determine variable features

    ## Setting min_variance to:  -Inf

    ## Calculating residuals of type pearson for 3000 genes

    ##   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |   0%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |   8%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |======================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |  17%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==========================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |  25%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=============================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |  33%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |  42%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |  50%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |  58%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                             |  67%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                          |  75%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                      |  83%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                   |  92%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================| 100%

    ## Computing corrected UMI count matrix

    ##   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |   0%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |   3%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |   6%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |   8%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |====================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |  11%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=====================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |  14%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |======================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |  17%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=======================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |  19%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |========================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |  22%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==========================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |  25%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===========================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |  28%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |============================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |  31%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=============================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |  33%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==============================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |  36%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |  39%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |  42%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |  44%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |  47%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |  50%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |  53%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |  56%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |  58%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |  61%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                                                              |  64%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                                                             |  67%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                                                            |  69%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                                                           |  72%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                                                          |  75%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                                                        |  78%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                                                       |  81%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                                                      |  83%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                                                     |  86%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                                                    |  89%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                                                   |  92%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                                                  |  94%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================                                 |  97%  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================| 100%

    ## Place corrected count matrix in counts slot

    ## Centering data matrix

    ## Set default assay to SCT

    ## Scoring heavy chain differences...

    ## Scoring light chain differences...

    ## Scoring cell cycle differences...

    ## Warning: The following features are not present in the object: CDC45, E2F8, not searching for symbol synonyms

    ## Warning: The following features are not present in the object: UBE2C, PIMREG, AURKB, HJURP, CDCA3, CDC20, CDC25C, DLGAP5, NEK2, not searching for symbol synonyms

``` r
# Save data for next step
saveRDS(object = qc_object, file = here("demo_data", "qc_object.RDS"))
```

``` r
session_info()
```

    ##  Session info 
    ##  setting  value
    ##  version  R version 4.1.2 (2021-11-01)
    ##  os       Ubuntu 20.04.3 LTS
    ##  system   x86_64, linux-gnu
    ##  ui       X11
    ##  language (EN)
    ##  collate  en_US.UTF-8
    ##  ctype    en_US.UTF-8
    ##  tz       Etc/UTC
    ##  date     2022-01-20
    ##  pandoc   2.14.0.3 @ /usr/lib/rstudio-server/bin/pandoc/ (via rmarkdown)
    ## 
    ##  Packages 
    ##  package              * version  date (UTC) lib source
    ##  abind                  1.4-5    2016-07-21 [1] RSPM (R 4.1.0)
    ##  Biobase                2.54.0   2021-10-26 [1] Bioconductor
    ##  BiocGenerics           0.40.0   2021-10-26 [1] Bioconductor
    ##  BiocManager          * 1.30.16  2021-06-15 [1] RSPM (R 4.1.0)
    ##  BiocNeighbors        * 1.12.0   2021-10-26 [1] Bioconductor
    ##  BiocParallel         * 1.28.3   2021-12-09 [1] Bioconductor
    ##  bitops                 1.0-7    2021-04-24 [1] RSPM (R 4.1.0)
    ##  cachem                 1.0.6    2021-08-19 [1] RSPM (R 4.1.0)
    ##  callr                  3.7.0    2021-04-20 [1] RSPM (R 4.1.0)
    ##  cli                    3.1.0    2021-10-27 [1] RSPM (R 4.1.0)
    ##  cluster                2.1.2    2021-04-17 [2] CRAN (R 4.1.2)
    ##  codetools              0.2-18   2020-11-04 [2] CRAN (R 4.1.2)
    ##  colorspace             2.0-2    2021-06-24 [1] RSPM (R 4.1.0)
    ##  cowplot                1.1.1    2020-12-30 [1] RSPM (R 4.1.0)
    ##  crayon                 1.4.2    2021-10-29 [1] RSPM (R 4.1.0)
    ##  data.table             1.14.2   2021-09-27 [1] RSPM (R 4.1.0)
    ##  DelayedArray           0.20.0   2021-10-26 [1] Bioconductor
    ##  deldir                 1.0-6    2021-10-23 [1] RSPM (R 4.1.0)
    ##  desc                   1.4.0    2021-09-28 [1] RSPM (R 4.1.0)
    ##  devtools             * 2.4.3    2021-11-30 [1] RSPM (R 4.1.0)
    ##  digest                 0.6.29   2021-12-01 [1] RSPM (R 4.1.0)
    ##  dplyr                * 1.0.7    2021-06-18 [1] RSPM (R 4.1.0)
    ##  ellipsis               0.3.2    2021-04-29 [1] RSPM (R 4.1.0)
    ##  evaluate               0.14     2019-05-28 [1] RSPM (R 4.1.0)
    ##  fansi                  1.0.2    2022-01-14 [1] RSPM (R 4.1.0)
    ##  fastmap                1.1.0    2021-01-25 [1] RSPM (R 4.1.0)
    ##  fitdistrplus           1.1-6    2021-09-28 [1] RSPM (R 4.1.0)
    ##  fs                     1.5.2    2021-12-08 [1] RSPM (R 4.1.0)
    ##  future               * 1.23.0   2021-10-31 [1] RSPM (R 4.1.0)
    ##  future.apply           1.8.1    2021-08-10 [1] RSPM (R 4.1.0)
    ##  generics               0.1.1    2021-10-25 [1] RSPM (R 4.1.0)
    ##  GenomeInfoDb           1.30.0   2021-10-26 [1] Bioconductor
    ##  GenomeInfoDbData       1.2.7    2022-01-20 [1] Bioconductor
    ##  GenomicRanges          1.46.1   2021-11-18 [1] Bioconductor
    ##  ggplot2                3.3.5    2021-06-25 [1] RSPM (R 4.1.0)
    ##  ggrepel                0.9.1    2021-01-15 [1] RSPM (R 4.1.0)
    ##  ggridges               0.5.3    2021-01-08 [1] RSPM (R 4.1.0)
    ##  glmGamPoi              1.6.0    2021-10-26 [1] Bioconductor
    ##  globals                0.14.0   2020-11-22 [1] RSPM (R 4.1.0)
    ##  glue                   1.6.0    2021-12-17 [1] RSPM (R 4.1.0)
    ##  goftest                1.2-3    2021-10-07 [1] RSPM (R 4.1.0)
    ##  gridExtra              2.3      2017-09-09 [1] RSPM (R 4.1.0)
    ##  gtable                 0.3.0    2019-03-25 [1] RSPM (R 4.1.0)
    ##  here                 * 1.0.1    2020-12-13 [1] RSPM (R 4.1.0)
    ##  htmltools              0.5.2    2021-08-25 [1] RSPM (R 4.1.0)
    ##  htmlwidgets            1.5.4    2021-09-08 [1] RSPM (R 4.1.0)
    ##  httpuv                 1.6.5    2022-01-05 [1] RSPM (R 4.1.0)
    ##  httr                   1.4.2    2020-07-20 [1] RSPM (R 4.1.0)
    ##  ica                    1.0-2    2018-05-24 [1] RSPM (R 4.1.0)
    ##  igraph                 1.2.11   2022-01-04 [1] RSPM (R 4.1.0)
    ##  IRanges                2.28.0   2021-10-26 [1] Bioconductor
    ##  irlba                  2.3.5    2021-12-06 [1] RSPM (R 4.1.0)
    ##  jsonlite               1.7.3    2022-01-17 [1] RSPM (R 4.1.0)
    ##  KernSmooth             2.23-20  2021-05-03 [2] CRAN (R 4.1.2)
    ##  knitr                  1.37     2021-12-16 [1] RSPM (R 4.1.0)
    ##  later                  1.3.0    2021-08-18 [1] RSPM (R 4.1.0)
    ##  lattice                0.20-45  2021-09-22 [2] CRAN (R 4.1.2)
    ##  lazyeval               0.2.2    2019-03-15 [1] RSPM (R 4.1.0)
    ##  leiden                 0.3.9    2021-07-27 [1] RSPM (R 4.1.0)
    ##  lifecycle              1.0.1    2021-09-24 [1] RSPM (R 4.1.0)
    ##  listenv                0.8.0    2019-12-05 [1] RSPM (R 4.1.0)
    ##  lmtest                 0.9-39   2021-11-07 [1] RSPM (R 4.1.0)
    ##  magrittr             * 2.0.1    2020-11-17 [1] RSPM (R 4.1.0)
    ##  MASS                   7.3-54   2021-05-03 [2] CRAN (R 4.1.2)
    ##  Matrix               * 1.3-4    2021-06-01 [2] CRAN (R 4.1.2)
    ##  MatrixGenerics         1.6.0    2021-10-26 [1] Bioconductor
    ##  matrixStats            0.61.0   2021-09-17 [1] RSPM (R 4.1.0)
    ##  memoise                2.0.1    2021-11-26 [1] RSPM (R 4.1.0)
    ##  mgcv                   1.8-38   2021-10-06 [2] CRAN (R 4.1.2)
    ##  mime                   0.12     2021-09-28 [1] RSPM (R 4.1.0)
    ##  miniUI                 0.1.1.1  2018-05-18 [1] RSPM (R 4.1.0)
    ##  munsell                0.5.0    2018-06-12 [1] RSPM (R 4.1.0)
    ##  nlme                   3.1-153  2021-09-07 [2] CRAN (R 4.1.2)
    ##  parallelly             1.30.0   2021-12-17 [1] RSPM (R 4.1.0)
    ##  patchwork              1.1.1    2020-12-17 [1] RSPM (R 4.1.0)
    ##  pbapply                1.5-0    2021-09-16 [1] RSPM (R 4.1.0)
    ##  pillar                 1.6.4    2021-10-18 [1] RSPM (R 4.1.0)
    ##  pkgbuild               1.3.1    2021-12-20 [1] RSPM (R 4.1.0)
    ##  pkgconfig              2.0.3    2019-09-22 [1] RSPM (R 4.1.0)
    ##  pkgload                1.2.4    2021-11-30 [1] RSPM (R 4.1.0)
    ##  plotly                 4.10.0   2021-10-09 [1] RSPM (R 4.1.0)
    ##  plyr                   1.8.6    2020-03-03 [1] RSPM (R 4.1.0)
    ##  png                    0.1-7    2013-12-03 [1] RSPM (R 4.1.0)
    ##  polyclip               1.10-0   2019-03-14 [1] RSPM (R 4.1.0)
    ##  prettyunits            1.1.1    2020-01-24 [1] RSPM (R 4.1.0)
    ##  processx               3.5.2    2021-04-30 [1] RSPM (R 4.1.0)
    ##  promises               1.2.0.1  2021-02-11 [1] RSPM (R 4.1.0)
    ##  ps                     1.6.0    2021-02-28 [1] RSPM (R 4.1.0)
    ##  purrr                  0.3.4    2020-04-17 [1] RSPM (R 4.1.0)
    ##  R6                     2.5.1    2021-08-19 [1] RSPM (R 4.1.0)
    ##  RANN                   2.6.1    2019-01-08 [1] RSPM (R 4.1.0)
    ##  RColorBrewer           1.1-2    2014-12-07 [1] RSPM (R 4.1.0)
    ##  Rcpp                   1.0.8    2022-01-13 [1] RSPM (R 4.1.0)
    ##  RcppAnnoy              0.0.19   2021-07-30 [1] RSPM (R 4.1.0)
    ##  RCurl                  1.98-1.5 2021-09-17 [1] RSPM (R 4.1.0)
    ##  remotes                2.4.2    2021-11-30 [1] RSPM (R 4.1.0)
    ##  reshape2               1.4.4    2020-04-09 [1] RSPM (R 4.1.0)
    ##  reticulate             1.23     2022-01-14 [1] RSPM (R 4.1.0)
    ##  rlang                  0.4.12   2021-10-18 [1] RSPM (R 4.1.0)
    ##  rmarkdown              2.11     2021-09-14 [1] RSPM (R 4.1.0)
    ##  ROCR                   1.0-11   2020-05-02 [1] RSPM (R 4.1.0)
    ##  rpart                  4.1-15   2019-04-12 [2] CRAN (R 4.1.2)
    ##  rprojroot              2.0.2    2020-11-15 [1] RSPM (R 4.1.0)
    ##  rstudioapi             0.13     2020-11-12 [1] RSPM (R 4.1.0)
    ##  Rtsne                  0.15     2018-11-10 [1] RSPM (R 4.1.0)
    ##  S4Vectors              0.32.3   2021-11-21 [1] Bioconductor
    ##  scales                 1.1.1    2020-05-11 [1] RSPM (R 4.1.0)
    ##  scattermore            0.7      2020-11-24 [1] RSPM (R 4.1.0)
    ##  sctransform            0.3.3    2022-01-13 [1] RSPM (R 4.1.0)
    ##  sessioninfo            1.2.2    2021-12-06 [1] RSPM (R 4.1.0)
    ##  Seurat               * 4.1.0    2022-01-14 [1] RSPM (R 4.1.0)
    ##  SeuratObject         * 4.0.4    2021-11-23 [1] RSPM (R 4.1.0)
    ##  shiny                  1.7.1    2021-10-02 [1] RSPM (R 4.1.0)
    ##  spatstat.core          2.3-2    2021-11-26 [1] RSPM (R 4.1.0)
    ##  spatstat.data          2.1-2    2021-12-17 [1] RSPM (R 4.1.0)
    ##  spatstat.geom          2.3-1    2021-12-10 [1] RSPM (R 4.1.0)
    ##  spatstat.sparse        2.1-0    2021-12-17 [1] RSPM (R 4.1.0)
    ##  spatstat.utils         2.3-0    2021-12-12 [1] RSPM (R 4.1.0)
    ##  stringi                1.7.6    2021-11-29 [1] RSPM (R 4.1.0)
    ##  stringr              * 1.4.0    2019-02-10 [1] RSPM (R 4.1.0)
    ##  SummarizedExperiment   1.24.0   2021-10-26 [1] Bioconductor
    ##  survival               3.2-13   2021-08-24 [2] CRAN (R 4.1.2)
    ##  tensor                 1.5      2012-05-05 [1] RSPM (R 4.1.0)
    ##  testthat               3.1.1    2021-12-03 [1] RSPM (R 4.1.0)
    ##  tibble                 3.1.6    2021-11-07 [1] RSPM (R 4.1.0)
    ##  tidyr                  1.1.4    2021-09-27 [1] RSPM (R 4.1.0)
    ##  tidyselect             1.1.1    2021-04-30 [1] RSPM (R 4.1.0)
    ##  usethis              * 2.1.5    2021-12-09 [1] RSPM (R 4.1.0)
    ##  utf8                   1.2.2    2021-07-24 [1] RSPM (R 4.1.0)
    ##  uwot                   0.1.11   2021-12-02 [1] RSPM (R 4.1.0)
    ##  vctrs                  0.3.8    2021-04-29 [1] RSPM (R 4.1.0)
    ##  viridisLite            0.4.0    2021-04-13 [1] RSPM (R 4.1.0)
    ##  withr                  2.4.3    2021-11-30 [1] RSPM (R 4.1.0)
    ##  xfun                   0.29     2021-12-14 [1] RSPM (R 4.1.0)
    ##  xtable                 1.8-4    2019-04-21 [1] RSPM (R 4.1.0)
    ##  XVector                0.34.0   2021-10-26 [1] Bioconductor
    ##  yaml                   2.2.1    2020-02-01 [1] RSPM (R 4.1.0)
    ##  zlibbioc               1.40.0   2021-10-26 [1] Bioconductor
    ##  zoo                    1.8-9    2021-03-09 [1] RSPM (R 4.1.0)
    ## 
    ##  [1] /usr/local/lib/R/site-library
    ##  [2] /usr/local/lib/R/library
    ## 
    ## 
